# 设备保养管理API文档

## 概述
本API用于管理设备保养计划、任务和执行记录，支持自定义保养计划和执行保养任务。

## 1. 保养计划管理

### 1.1 创建保养计划
**POST** `/api/maintenance/plans`

#### 请求体
```json
{
  "equipmentId": 1,
  "name": "日常保养计划",
  "category": "daily",
  "cycle": 7,
  "cycleUnit": "days",
  "executor": "张三",
  "items": [
    {
      "name": "清洁导轨",
      "category": "清洁类",
      "standard": "导轨无灰尘、油污",
      "method": "使用无尘布和专用清洁剂擦拭",
      "problemHandling": "发现生锈立即报告",
      "handlingMethod": "",
      "tools": "无尘布,清洁剂",
      "remark": ""
    }
  ]
}
```

#### 成功响应
```json
{
  "success": true,
  "message": "保养计划创建成功",
  "data": {
    "id": 123
  }
}
```

### 1.2 获取保养计划详情
**GET** `/api/maintenance/plans/{id}`

#### 路径参数
- `id`: 保养计划ID

#### 成功响应
```json
{
  "success": true,
  "data": {
    "id": 123,
    "equipmentId": 1,
    "name": "日常保养计划",
    "category": "daily",
    "cycle": 7,
    "cycleUnit": "days",
    "executor": "张三",
    "createdAt": "2025-07-31T10:30:00Z",
    "items": [
      {
        "id": 101,
        "name": "清洁导轨",
        "category": "清洁类",
        "standard": "导轨无灰尘、油污",
        "method": "使用无尘布和专用清洁剂擦拭",
        "problemHandling": "发现生锈立即报告",
        "handlingMethod": "",
        "tools": "无尘布,清洁剂",
        "remark": ""
      }
    ]
  }
}
```

## 2. 保养任务管理

### 2.1 获取任务详情
**GET** `/api/maintenance/tasks/{id}`

#### 路径参数
- `id`: 保养任务ID

#### 成功响应
```json
{
  "success": true,
  "data": {
    "id": 456,
    "planId": 123,
    "equipmentId": 1,
    "equipmentName": "立式加工中心-MC001",
    "taskName": "日常保养检查",
    "status": "IN_PROGRESS",
    "plannedDate": "2025-08-01",
    "executor": "张三",
    "startTime": "2025-08-01T09:00:00Z",
    "items": [
      {
        "id": 1,
        "name": "清洁导轨",
        "category": "清洁类",
        "standard": "导轨无灰尘、油污",
        "method": "使用无尘布和专用清洁剂擦拭",
        "problemHandling": "发现生锈立即报告",
        "handlingMethod": "",
        "tools": "无尘布,清洁剂",
        "completed": false,
        "result": "",
        "problem": "",
        "photos": []
      }
    ]
  }
}
```

### 2.2 完成任务
**POST** `/api/maintenance/tasks/{id}/complete`

#### 路径参数
- `id`: 保养任务ID

#### 请求体
```json
{
  "items": [
    {
      "id": 1,
      "result": "清洁完成，无异常",
      "problem": "",
      "handlingMethod": "",
      "photos": ["url1", "url2"]
    },
    {
      "id": 2,
      "result": "油位正常",
      "problem": "发现轻微渗油",
      "handlingMethod": "紧固油管接头",
      "photos": ["url3"]
    }
  ],
  "remarks": "整体设备状态良好"
}
```

#### 成功响应
```json
{
  "success": true,
  "message": "任务完成"
}
```

## 3. 数据库表结构

### 保养计划表 (maintenance_plan)
```sql
CREATE TABLE `maintenance_plan` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `equipment_id` INT NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `category` ENUM('daily', 'weekly', 'monthly', 'quarterly', 'yearly') NOT NULL,
  `cycle` INT NOT NULL,
  `cycle_unit` ENUM('days', 'weeks', 'months') NOT NULL,
  `executor` VARCHAR(100) NOT NULL,
  `created_at` DATETIME NOT NULL,
  PRIMARY KEY (`id`)
);
```

### 保养项表 (maintenance_item)
```sql
CREATE TABLE `maintenance_item` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `plan_id` INT NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `category` VARCHAR(100) DEFAULT NULL,
  `standard` TEXT DEFAULT NULL,
  `method` TEXT DEFAULT NULL,
  `problem_handling` TEXT DEFAULT NULL,
  `handling_method` VARCHAR(255) DEFAULT NULL,
  `tools` VARCHAR(255) DEFAULT NULL,
  `remark` TEXT DEFAULT NULL,
  PRIMARY KEY (`id`)
);
```

### 保养任务表 (maintenance_task)
```sql
CREATE TABLE `maintenance_task` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `plan_id` INT NOT NULL,
  `equipment_id` INT NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `status` ENUM('PENDING', 'IN_PROGRESS', 'COMPLETED', 'CANCELLED') NOT NULL,
  `planned_date` DATE NOT NULL,
  `executor` VARCHAR(100) NOT NULL,
  `start_time` DATETIME DEFAULT NULL,
  `end_time` DATETIME DEFAULT NULL,
  PRIMARY KEY (`id`)
);
```

### 保养执行记录表 (maintenance_record)
```sql
CREATE TABLE `maintenance_record` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `task_id` INT NOT NULL,
  `item_id` INT NOT NULL,
  `result` TEXT DEFAULT NULL,
  `problem` TEXT DEFAULT NULL,
  `handling_method` VARCHAR(255) DEFAULT NULL,
  `photos` JSON DEFAULT NULL,
  PRIMARY KEY (`id`)
);
```

## 使用示例

### 创建保养计划
```bash
curl -X POST http://localhost:8080/api/maintenance/plans \
  -H "Content-Type: application/json" \
  -H "token: YOUR_TOKEN" \
  -d '{
    "equipmentId": 1,
    "name": "日常保养计划",
    "category": "daily",
    "cycle": 7,
    "cycleUnit": "days",
    "executor": "张三",
    "items": [
      {
        "name": "清洁导轨",
        "category": "清洁类",
        "standard": "导轨无灰尘、油污",
        "method": "使用无尘布和专用清洁剂擦拭"
      }
    ]
  }'
```

### 获取任务详情
```bash
curl -X GET "http://localhost:8080/api/maintenance/tasks/456" \
  -H "token: YOUR_TOKEN"
```

### 完成任务
```bash
curl -X POST http://localhost:8080/api/maintenance/tasks/456/complete \
  -H "Content-Type: application/json" \
  -H "token: YOUR_TOKEN" \
  -d '{
    "items": [
      {
        "id": 1,
        "result": "清洁完成，无异常",
        "photos": ["url1.jpg", "url2.jpg"]
      }
    ]
  }'
```
```

## 实现说明

1. **自定义保养计划功能**：
   - 在设备保养页面新增"自定义保养计划"按钮
   - 弹出对话框可设置计划名称、类别、周期、执行人等
   - 支持添加多个保养项，每个保养项包含详细属性

2. **保养执行页面**：
   - 创建新的`MaintenanceAction.vue`页面
   - 展示任务信息和所有保养项
   - 每个保养项可独立操作（填写结果、上传图片等）
   - 支持标记单个保养项完成
   - 完成所有保养项后可提交整个任务

3. **API 更新**：
   - 新增保养计划相关API方法
   - 添加任务详情获取和任务完成方法
   - 使用假数据模拟API响应

4. **API 文档**：
   - 提供完整的API端点文档
   - 包含请求/响应示例
   - 提供数据库表结构设计
   - 包含CURL命令使用示例

这些实现完全遵循了您的要求，保留了原有功能的同时新增了自定义保养计划和保养执行功能，并提供了完整的API文档供后端开发参考。
